<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./src/css/home.css" />
  <link rel="icon" type="image/x-icon" href="./favicon.ico" />
  <title>Home - SafeByte</title>
</head>

<body>
  <!-- botones para cambiar entre secciones -->
  <div class="navbar">
    <div class="logo">SafeByte</div>
    <ul class="nav-links">
      <li><a href="#" data-section="welcome-section" class="nav-btn">Home</a></li>
      <li><a href="./comidas.html">Comidas</a></li>
      <li><a href="#" data-section="contact-section" class="nav-btn">Contacta con Nosotros</a></li>
      <li><a href="#" data-section="scanner-section" class="nav-btn">Scanner</a></li>
      <li><a href="#" data-section="config-section" class="nav-btn">Configuración de Usuario</a></li>
      <li><a href="./index.html">Cerrar Sesión</a></li>
    </ul>
  </div>

  <!-- Secciones para poder tener info en diferentes ventanas estando en un mismo html-->
  <section id="scanner-section" class="content-section">
    <h2>Escanear Código de Barras</h2>
    <div id="scanner-container">
        <div id="video"></div>
        <button onclick="startScanner()">Iniciar Escáner</button>
    </div>
    <div id="result"></div>
  </section>

  <section id="contact-section" class="content-section hidden">
    <h2>Contacta con Nosotros</h2>
    <p>¿Tienes preguntas? ¡Estamos aquí para ayudarte!</p>
    <form>
      <input type="text" placeholder="Tu nombre" required />
      <input type="email" placeholder="Tu correo" required />
      <textarea placeholder="Tu mensaje" required></textarea>
      <button type="submit">Enviar</button>
    </form>
  </section>
   <!-- Seccion scanner comida -->
  <section id="welcome-section" class="content-section">
    <h1>Bienvenido a SafeByte</h1>
    <p>
      Nuestra aplicación está diseñada para ofrecerte comidas seguras basadas en tus alergias alimentarias. Explora
      nuestras opciones y disfruta de una experiencia personalizada.
    </p>
  </section>
  <!-- Configuracion de alergenos con checkboxes para seleccionar y guardar la info esto se usa con el js de home que guarda la info en local y luego filtra la comida-->
  <section id="config-section" class="content-section hidden">
    <h2>Configuración de Usuario</h2>
    <p>Selecciona los alérgenos que deseas evitar en las comidas.</p>

    <form id="alergenos-form">
      <div class="checkbox-container">
        <label class="custom-checkbox">
          <input type="checkbox" name="alergeno" value="Gluten" />
          <span class="checkmark"></span> Gluten
        </label>
        <label class="custom-checkbox">
          <input type="checkbox" name="alergeno" value="Lácteos" />
          <span class="checkmark"></span> Lácteos
        </label>
        <label class="custom-checkbox">
          <input type="checkbox" name="alergeno" value="Huevo" />
          <span class="checkmark"></span> Huevo
        </label>
        <label class="custom-checkbox">
          <input type="checkbox" name="alergeno" value="Frutos secos" />
          <span class="checkmark"></span> Frutos secos
        </label>
        <label class="custom-checkbox">
          <input type="checkbox" name="alergeno" value="Mariscos" />
          <span class="checkmark"></span> Mariscos
        </label>
        <label class="custom-checkbox">
          <input type="checkbox" name="alergeno" value="Soja" />
          <span class="checkmark"></span> Soja
        </label>
      </div>

      <button type="button" id="save-alergenos">Guardar preferencias</button>
    </form>

    <p id="confirmation-message" style="display: none; color: green;">Preferencias guardadas con éxito.</p>
  </section>

  <footer>
    <p>SafeByte 2025.</p>
  </footer>

  <script src="./src/ventanas/Home.js"></script>

    <!-- script de js que almacena los alergenos guardados en local -->
  <script>
    document.getElementById("save-alergenos").addEventListener("click", () => {
      const alergenosSeleccionados = Array.from(
        document.querySelectorAll('input[name="alergeno"]:checked')
      ).map((checkbox) => checkbox.value);

      localStorage.setItem("alergenosSeleccionados", JSON.stringify(alergenosSeleccionados));

      document.getElementById("confirmation-message").style.display = "block";
      setTimeout(() => {
        document.getElementById("confirmation-message").style.display = "none";
      }, 2000);
    });



    function startScanner() {
      Quagga.init({
          inputStream: {
              type: "LiveStream",
              constraints: {
                  facingMode: "environment"
              },
              target: document.querySelector("#video")
          },
          decoder: {
              readers: ["ean_reader"]
          }
      }, function(err) {
          if (err) {
              console.error("Error al iniciar Quagga:", err);
              return;
          }
          Quagga.start();
      });

      Quagga.onDetected(async function(result) {
          Quagga.stop();
          const codigoBarras = result.codeResult.code;
          document.getElementById("result").innerHTML = <p>Código detectado: ${codigoBarras}</p>;

          const apiUrl = https://world.openfoodfacts.org/api/v0/product/${codigoBarras}.json;
          try {
              const response = await fetch(apiUrl);
              const data = await response.json();
              
              if (data.status === 1) {
                  const producto = data.product;
                  document.getElementById("result").innerHTML += `
                      <p><strong>Nombre:</strong> ${producto.product_name || "Desconocido"}</p>
                      <p><strong>Ingredientes:</strong> ${producto.ingredients_text || "No disponible"}</p>
                      <p><strong>Alérgenos:</strong> ${producto.allergens || "No especificado"}</p>
                      <img src="${producto.image_url || ''}" alt="Imagen del producto" width="150">
                  `;
              } else {
                  document.getElementById("result").innerHTML += "<p>Producto no encontrado.</p>";
              }
          } catch (error) {
              console.error("Error al consultar la API:", error);
              document.getElementById("result").innerHTML += "<p>Error al obtener información.</p>";
          }
      });
  }

  </script>
</body>

</html>